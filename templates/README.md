static/README.md
# Templates - Детальное описание

Templates/шаблоны представляет собой фундаментальную часть пользовательского интерфейса системы X-RouterSBC, построенную на основе современного UI-фреймворка Tabler.io. Этот модуль отвечает за визуальное представление всех функций системы управления маршрутизатором и обеспечивает интуитивно понятный интерфейс для конфигурирования сетевых параметров.

## Архитектурные принципы шаблонной системы

Шаблонная система построена на принципе разделения логики представления от бизнес-логики. Каждый шаблон представляет собой HTML5-документ, который получает данные через Go-шаблонизатор Echo Framework и обновляется в реальном времени через WebSocket-соединения. Это обеспечивает динамическое обновление интерфейса без необходимости полной перезагрузки страницы.

Основой всех шаблонов служит Tabler.io - современный административный интерфейс, построенный на Bootstrap 5. Это обеспечивает консистентность внешнего вида, адаптивность под различные размеры экранов и богатый набор готовых компонентов для построения сложных интерфейсов.

## Базовая структура шаблонов

### Корневые шаблоны

Система использует иерархическую структуру шаблонов, где базовый шаблон определяет общую структуру страницы, включая навигацию, футер и основные стили. Дочерние шаблоны наследуют эту структуру и добавляют специфичный для страницы контент.

**Базовый шаблон** (`base.html`) содержит общие элементы интерфейса: верхнюю навигационную панель с логотипом системы и информацией о пользователе, боковое меню с основными разделами управления, область для отображения уведомлений и модальных окон, а также подключение всех необходимых CSS и JavaScript файлов.

**Шаблоны ошибок** предназначены для обработки различных HTTP-статусов. Шаблон `404.html` отображается когда запрашиваемая страница не найдена, предоставляя пользователю понятное объяснение ошибки и навигационные ссылки для возврата к основным разделам системы. Шаблон `501.html` используется для отображения ошибок сервера, когда запрашиваемая функциональность не реализована или временно недоступна.

## Сетевые шаблоны - детальный анализ

### Главная страница сети (network/index.html)

Этот шаблон служит центральной панелью мониторинга сетевой подсистемы. Страница представляет собой дашборд с виджетами, отображающими текущее состояние всех сетевых интерфейсов, статистику трафика, активные соединения и общую информацию о состоянии системы.

Виджеты на главной странице обновляются в реальном времени через WebSocket, показывая актуальную информацию о пропускной способности интерфейсов, количестве активных соединений, состоянии WAN-подключений и работе firewall. Каждый виджет содержит ссылки на соответствующие разделы детальной конфигурации.

### Управление интерфейсами (network/interfaces.html)

Шаблон управления интерфейсами организован в виде табличного интерфейса с тремя основными вкладками, каждая из которых отвечает за определенный тип сетевых интерфейсов.

**Вкладка Physical** отображает все физические сетевые адаптеры системы. Для каждого интерфейса показывается его тип (Ethernet, Wi-Fi, Bluetooth), текущий статус (активен/неактивен), назначенные IP-адреса, MAC-адрес и статистика трафика. Пользователь может настраивать базовые параметры каждого интерфейса, такие как MTU, скорость соединения и дуплексный режим.

**Вкладка VLAN** предназначена для управления виртуальными локальными сетями. Здесь отображаются все созданные VLAN-интерфейсы с указанием их ID, родительского интерфейса, IP-конфигурации и назначения. Пользователь может создавать новые VLAN, настраивать их параметры и управлять мостовыми соединениями между различными сегментами сети.

**Вкладка VPN connection** управляет всеми типами VPN-подключений. Это включает WireGuard-туннели с отображением публичных ключей и endpoint'ов, PPP-соединения с настройками аутентификации, PPTP-подключения и пользовательские TUN-интерфейсы. Каждое соединение отображается с информацией о статусе подключения, переданном трафике и конфигурационных параметрах.

### Конфигурация WAN (network/wan.html)

WAN-шаблон представляет собой сложный интерфейс для настройки внешних подключений к интернету. Он организован в три основные вкладки, каждая из которых решает специфические задачи подключения к внешним сетям.

**Вкладка General WAN** позволяет выбрать основной интерфейс для подключения к интернету. Пользователь может выбирать между проводными Ethernet-интерфейсами и беспроводными Wi-Fi адаптерами. Важно отметить, что Wi-Fi адаптеры становятся доступными для выбора в качестве WAN только после успешного установления STA-соединения с внешней Wi-Fi сетью. В этой вкладке настраиваются основные параметры подключения: тип получения IP-адреса (DHCP, статический, PPPoE), DNS-серверы, шлюз по умолчанию и параметры аутентификации.

**Вкладка Multi WAN** реализует продвинутую функциональность балансировки нагрузки между несколькими WAN-подключениями. Здесь можно настроить несколько независимых подключений к интернету и определить политики их использования: равномерное распределение трафика, приоритизация одного канала с резервированием через другой, или распределение трафика по типу приложений. Каждое WAN-подключение отображается с метриками качества соединения, включая задержку, потери пакетов и доступную пропускную способность.

**Вкладка WAN Settings** содержит глобальные настройки для всех WAN-подключений. Это включает настройки мониторинга доступности соединений, параметры автоматического переключения между каналами при сбоях, конфигурацию Quality of Service (QoS) для приоритизации трафика и настройки NAT для правильной маршрутизации исходящего трафика.

### Локальная сеть (network/lan.html)

LAN-шаблон управляет всеми аспектами локальной сети и организован в три ключевые вкладки.

**Вкладка DHCP** предоставляет полный контроль над службой автоматического назначения IP-адресов. Пользователь может выбрать один из трех режимов работы: Relay (ретрансляция DHCP-запросов на внешний сервер), Server (локальный DHCP-сервер) или Disabled (отключение DHCP). В режиме сервера настраиваются диапазоны IP-адресов для раздачи, время аренды адресов, статические резервации для конкретных устройств по MAC-адресам, и дополнительные DHCP-опции, такие как NTP-серверы, домен поиска и настройки загрузки по сети.

**Вкладка DNS** управляет системой разрешения доменных имен и предоставляет четыре режима работы. Режим Direct ISP направляет все DNS-запросы напрямую к серверам интернет-провайдера. Режим Proxy кэширует DNS-ответы для ускорения повторных запросов. Режим Forward позволяет настроить пересылку определенных доменов на конкретные DNS-серверы. Режим Server превращает устройство в полноценный DNS-сервер с возможностью создания локальных DNS-зон. Дополнительно настраиваются безопасные DNS-соединения через DoT (DNS over TLS) и DoH (DNS over HTTPS), а также географическая маршрутизация DNS-запросов.

**Вкладка Bridge Settings** конфигурирует мостовые соединения между различными сетевыми интерфейсами. Здесь создаются и настраиваются программные мосты, объединяющие несколько физических или виртуальных интерфейсов в одну широковещательную область. Настраиваются параметры Spanning Tree Protocol для предотвращения петель в сети и VLAN-фильтрация для мостов.

### Беспроводные сети (network/wireless.html)

Шаблон беспроводных сетей предоставляет полный контроль над Wi-Fi адаптерами и организован в четыре основных режима работы.

**Режим AP (Access Point)** превращает Wi-Fi адаптер в точку доступа. Настраиваются SSID сети, тип шифрования (WPA2, WPA3, WEP или открытая сеть), пароль доступа, канал вещания и мощность передатчика. Дополнительно настраиваются параметры изоляции клиентов, скрытие SSID, ограничения скорости для подключенных устройств и белые/черные списки MAC-адресов.

**Режим STA (Station/Managed)** позволяет подключиться к существующей Wi-Fi сети в качестве клиента. Отображается список доступных сетей с информацией о силе сигнала, типе шифрования и используемом канале. Настраиваются параметры подключения, включая автоматическое переподключение, роуминг между точками доступа и управление энергопотреблением.

**Режим ADHOC/IBSS** создает одноранговую беспроводную сеть без центральной точки доступа. Настраиваются параметры для прямого соединения между устройствами, включая SSID, канал, ключи шифрования и топологию сети.

**Режим MONITOR** переводит Wi-Fi адаптер в режим мониторинга для анализа беспроводного трафика. Этот режим используется для диагностики сетевых проблем, анализа безопасности и мониторинга использования радиочастотного спектра.

### Маршрутизация (network/routing.html)

Шаблон маршрутизации управляет правилами передачи сетевого трафика и содержит две основные вкладки.

**Вкладка Static Route** позволяет создавать и управлять статическими маршрутами. Для каждого маршрута настраиваются целевая сеть (IP-адрес и маска подсети), интерфейс для передачи трафика, IP-адрес следующего узла (gateway) и метрика маршрута для определения приоритета при наличии нескольких путей к одной сети. Таблица маршрутов отображается в удобном формате с возможностью сортировки и фильтрации.

**Вкладка UPnP IGD & PCP** управляет службами автоматического проброса портов. Universal Plug and Play Internet Gateway Device позволяет приложениям автоматически настраивать правила NAT для входящих соединений. Port Control Protocol предоставляет более современный механизм управления портами. Настраиваются параметры STUN-серверов для определения внешнего IP-адреса, правила Traffic Shaping для ограничения пропускной способности автоматически создаваемых правил и политики безопасности для контроля над тем, какие приложения могут создавать правила проброса портов.

### Межсетевой экран (network/firewall.html)

Шаблон межсетевого экрана представляет собой наиболее сложный компонент системы, так как он динамически подгружает один из двух специализированных шаблонов в зависимости от выбранного backend'а.

Основной шаблон определяет, какая система фильтрации пакетов используется в системе - современный NFTables или классический IPTables. На основе этого выбора подгружается соответствующий специализированный шаблон с интерфейсом, адаптированным под особенности конкретной системы.

**NFTables интерфейс** (network/firewall_new.html) предоставляет современный подход к управлению правилами фильтрации. Он организован в виде таблиц, каждая из которых содержит цепочки правил для обработки различных типов трафика. Интерфейс позволяет создавать именованные наборы IP-адресов и портов для упрощения управления правилами, использовать переменные для часто используемых значений и создавать сложные правила с множественными условиями.

**IPTables интерфейс** (network/firewall_classic.html) предоставляет традиционный подход к управлению фильтрацией пакетов. Правила организованы в виде цепочек (chains) в таблицах filter, nat и mangle. Интерфейс адаптирован под линейную структуру IPTables-правил и предоставляет упрощенные формы для создания наиболее распространенных типов правил.

Оба интерфейса содержат несколько общих разделов:

**Раздел General Rules** содержит основные правила фильтрации трафика. Здесь создаются правила для разрешения или блокировки трафика на основе IP-адресов источника и назначения, портов, протоколов и других параметров пакетов. Правила отображаются в табличном формате с возможностью изменения их порядка, так как последовательность применения правил критически важна.

**Раздел Chains** управляет цепочками обработки пакетов. Пользователь может создавать пользовательские цепочки для группировки связанных правил, настраивать политики по умолчанию для встроенных цепочек (INPUT, OUTPUT, FORWARD) и управлять переходами между цепочками.

**Раздел Port Access** предоставляет упрощенный интерфейс для управления доступом к портам. Здесь можно быстро открыть или закрыть определенные порты, настроить проброс портов (port forwarding) для перенаправления внешних подключений на внутренние серверы и создать правила для ограничения доступа к сервисам по времени или источнику подключения.

**Раздел Firewall Settings** содержит глобальные настройки системы фильтрации. Здесь выбирается backend для обработки правил (NFTables или IPTables), настраиваются параметры логирования заблокированных соединений, конфигурируется интеграция с системами обнаружения вторжений и управляются глобальные политики безопасности.

## Модальные окна (network/modal.html)

Модальные окна представляют собой ключевой элемент пользовательского интерфейса, обеспечивающий интуитивный способ конфигурирования сложных сетевых параметров без необходимости перехода на отдельные страницы.

**Модальные окна STUN Server и UPnP** позволяют настраивать серверы для определения внешнего IP-адреса и управления автоматическим пробросом портов. Пользователь может добавлять новые STUN-серверы, указывая их адреса и порты, настраивать таймауты и интервалы опроса.

**Модальное окно Static Route** предоставляет форму для создания статических маршрутов. Включает поля для ввода целевой сети, выбора интерфейса из выпадающего списка, указания шлюза и настройки метрики маршрута. Форма включает валидацию для предотвращения создания некорректных маршрутов.

**Модальные окна Firewall** включают отдельные формы для различных типов правил межсетевого экрана. Форма создания правил содержит поля для выбора действия (разрешить/запретить), протокола, портов источника и назначения, IP-адресов и дополнительных условий. Форма создания цепочек позволяет указать имя цепочки, её тип и политику по умолчанию.

**Модальное окно Network Interface** предоставляет мастер создания новых сетевых интерфейсов. В зависимости от выбранного типа интерфейса (Tun2socks, VLAN, VWF) отображаются соответствующие поля конфигурации. Для Tun2socks настраиваются TCP и UDP порты, для VLAN - родительский интерфейс и VLAN ID, для всех типов - IP-адрес, маска подсети и дополнительные параметры.

**Модальные окна DNS** включают формы для управления локальными DNS-зонами, настройки резолверов и конфигурирования географической маршрутизации. Форма локальных зон позволяет создавать записи типа A, AAAA, CNAME и MX для локального домена. Форма резолверов поддерживает различные протоколы (UDP, TCP, TLS, HTTPS) и позволяет настраивать приоритеты и таймауты.

**Модальные окна WiFi** предоставляют специализированные формы для настройки беспроводных соединений. Форма Station-подключения включает сканер доступных сетей, поля для ввода пароля и настройки продвинутых параметров подключения. Форма Access Point содержит настройки для создания точки доступа, включая выбор канала, настройку мощности передатчика и параметры безопасности.

## Технические особенности и WebSocket интеграция

Все шаблоны интегрированы с WebSocket-системой для обеспечения обновлений в реальном времени. JavaScript-код в каждом шаблоне подписывается на соответствующие WebSocket-события для получения обновлений о состоянии системы. Это позволяет мгновенно отображать изменения в конфигурации без необходимости обновления страницы.

Система обработки ошибок встроена в каждый шаблон и обеспечивает отображение понятных сообщений об ошибках пользователю. Все формы включают клиентскую и серверную валидацию для предотвращения отправки некорректных данных.

Адаптивный дизайн на основе Tabler.io обеспечивает корректное отображение интерфейса на различных устройствах - от настольных компьютеров до планшетов и смартфонов. Это особенно важно для системы управления маршрутизатором, которая может потребовать доступа в критических ситуациях с любого доступного устройства.
